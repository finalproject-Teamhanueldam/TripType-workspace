BEGIN EXECUTE IMMEDIATE 'DROP TABLE TB_NOTICE_COMMENT CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE TB_NOTICE_ATTACHMENT CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE TB_NOTICE CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/

BEGIN EXECUTE IMMEDIATE 'DROP SEQUENCE TB_NOTICE_COMMENT_SEQ'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP SEQUENCE TB_NOTICE_ATTACHMENT_SEQ'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP SEQUENCE TB_NOTICE_SEQ'; EXCEPTION WHEN OTHERS THEN NULL; END;
/


-- 시퀀스 및 테이블 생성
CREATE SEQUENCE TB_NOTICE_COMMENT_SEQ START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE;
CREATE SEQUENCE TB_NOTICE_ATTACHMENT_SEQ START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE;
CREATE SEQUENCE TB_NOTICE_SEQ START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE;

-- 4) NOTICE
CREATE TABLE TB_NOTICE (
  NOTICE_ID NUMBER NOT NULL,
  NOTICE_TITLE VARCHAR2(150) NOT NULL,
  NOTICE_CONTENT VARCHAR2(500) NOT NULL,
  NOTICE_CREATED_AT DATE DEFAULT SYSDATE NOT NULL,
  NOTICE_UPDATED_AT DATE DEFAULT SYSDATE NOT NULL,
  NOTICE_VIEWS NUMBER NOT NULL,
  NOTICE_IS_IMPORTANT CHAR(1) DEFAULT 'N' NOT NULL,
  NOTICE_IS_DEL CHAR(1) DEFAULT 'N' NOT NULL,

  CONSTRAINT PK_NOT PRIMARY KEY (NOTICE_ID)
);
-- 12) NOTICE_ATTACHMENT
CREATE TABLE TB_NOTICE_ATTACHMENT (
  NOTICE_ATTACHMENT_ID NUMBER NOT NULL,
  NOTICE_ATTACHMENT_NAME VARCHAR2(255) NOT NULL,
  NOTICE_ATTACHMENT_UPDATE VARCHAR2(500) NOT NULL,
  NOTICE_ATTACHMENT_URL VARCHAR2(255) NOT NULL,
  NOTICE_ATTACHMENT_UPLOADED_AT DATE DEFAULT SYSDATE NOT NULL,
  NOTICE_ATTACHMENT_IS_DEL CHAR(1) DEFAULT 'N' NOT NULL,
  NOTICE_ID NUMBER,

  CONSTRAINT PK_NAT PRIMARY KEY (NOTICE_ATTACHMENT_ID),
  CONSTRAINT FK_NAT_NOT FOREIGN KEY (NOTICE_ID) REFERENCES TB_NOTICE (NOTICE_ID)
);
-- 13) NOTICE_COMMENT
CREATE TABLE TB_NOTICE_COMMENT (
  NOTICE_COMMENT_ID NUMBER NOT NULL,
  NOTICE_COMMENT_CONTENT VARCHAR2(300) NOT NULL,
  NOTICE_COMMENT_CREATED_AT DATE DEFAULT SYSDATE NOT NULL,
  NOTICE_COMMENT_UPDATED_AT DATE DEFAULT SYSDATE NOT NULL,
  NOTICE_COMMENT_IS_DEL CHAR(1) DEFAULT 'N' NOT NULL,
  NOTICE_ID NUMBER,
  MEMBER_NO NUMBER NOT NULL,

  CONSTRAINT PK_NCM PRIMARY KEY (NOTICE_COMMENT_ID),
  CONSTRAINT FK_NCM_NOT FOREIGN KEY (NOTICE_ID) REFERENCES TB_NOTICE (NOTICE_ID),
  CONSTRAINT FK_NCM_MEM FOREIGN KEY (MEMBER_NO) REFERENCES TB_MEMBER (MEMBER_NO)
);

-- 트리거 생성
CREATE OR REPLACE TRIGGER TB_NOTICE_COMMENT_TRG
BEFORE INSERT ON TB_NOTICE_COMMENT
FOR EACH ROW
BEGIN
  IF :NEW.NOTICE_COMMENT_ID IS NULL THEN
    SELECT TB_NOTICE_COMMENT_SEQ.NEXTVAL INTO :NEW.NOTICE_COMMENT_ID FROM DUAL;
  END IF;
END;
/
CREATE OR REPLACE TRIGGER TB_NOTICE_ATTACHMENT_TRG
BEFORE INSERT ON TB_NOTICE_ATTACHMENT
FOR EACH ROW
BEGIN
  IF :NEW.NOTICE_ATTACHMENT_ID IS NULL THEN
    SELECT TB_NOTICE_ATTACHMENT_SEQ.NEXTVAL INTO :NEW.NOTICE_ATTACHMENT_ID FROM DUAL;
  END IF;
END;
/
CREATE OR REPLACE TRIGGER TB_NOTICE_TRG
BEFORE INSERT ON TB_NOTICE
FOR EACH ROW
BEGIN
  IF :NEW.NOTICE_ID IS NULL THEN
    SELECT TB_NOTICE_SEQ.NEXTVAL INTO :NEW.NOTICE_ID FROM DUAL;
  END IF;
END;
/