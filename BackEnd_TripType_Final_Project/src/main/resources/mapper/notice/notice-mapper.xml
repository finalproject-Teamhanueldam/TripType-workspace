<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kh.triptype.notice.dao.NoticeDao">

    <!-- ========================= -->
    <!-- ResultMap -->
    <!-- ========================= -->
    <resultMap id="noticeResultMap"
               type="com.kh.triptype.notice.model.vo.Notice">

        <id     property="noticeId"          column="NOTICE_ID"/>
        <result property="noticeTitle"       column="NOTICE_TITLE"/>
        <result property="noticeContent"     column="NOTICE_CONTENT"/>
        <result property="noticeCreatedAt"   column="NOTICE_CREATED_AT"/>
        <result property="noticeUpdatedAt"   column="NOTICE_UPDATED_AT"/>
        <result property="noticeViews"       column="NOTICE_VIEWS"/>
        <result property="noticeIsImportant" column="NOTICE_IS_IMPORTANT"/>
        <result property="noticeIsDel"       column="NOTICE_IS_DEL"/>
    </resultMap>

    <!-- ========================= -->
    <!-- 사용자 : 공지 목록 -->
    <!-- ========================= -->
    <select id="selectNoticeList" resultMap="noticeResultMap">
        SELECT
            NOTICE_ID,
            NOTICE_TITLE,
            NOTICE_CONTENT,
            NOTICE_CREATED_AT,
            NOTICE_UPDATED_AT,
            NOTICE_VIEWS,
            NOTICE_IS_IMPORTANT,
            NOTICE_IS_DEL
        FROM TB_NOTICE
        WHERE NOTICE_IS_DEL = 'N'
        ORDER BY NOTICE_IS_IMPORTANT DESC,
                 NOTICE_CREATED_AT DESC
    </select>

    <!-- ========================= -->
    <!-- 사용자 : 공지 상세 -->
    <!-- ========================= -->
    <select id="selectNoticeDetail"
            parameterType="map"
            resultMap="noticeResultMap">

        SELECT
            NOTICE_ID,
            NOTICE_TITLE,
            NOTICE_CONTENT,
            NOTICE_CREATED_AT,
            NOTICE_UPDATED_AT,
            NOTICE_VIEWS,
            NOTICE_IS_IMPORTANT,
            NOTICE_IS_DEL
        FROM TB_NOTICE
        WHERE NOTICE_ID = #{noticeId}
          AND NOTICE_IS_DEL = 'N'
    </select>

    <!-- ========================= -->
    <!-- 관리자 : 공지 등록 -->
    <!-- ========================= -->
    <insert id="insertNotice"
            parameterType="com.kh.triptype.notice.model.vo.Notice">

        INSERT INTO TB_NOTICE (
            NOTICE_ID,
            NOTICE_TITLE,
            NOTICE_CONTENT,
            NOTICE_CREATED_AT,
            NOTICE_UPDATED_AT,
            NOTICE_VIEWS,
            NOTICE_IS_IMPORTANT,
            NOTICE_IS_DEL
        ) VALUES (
            SEQ_NOTICE_ID.NEXTVAL,
            #{noticeTitle},
            #{noticeContent},
            SYSDATE,
            SYSDATE,
            0,
            #{noticeIsImportant},
            'N'
        )
    </insert>

    <!-- ========================= -->
    <!-- 관리자 : 공지 수정 -->
    <!-- ========================= -->
    <update id="updateNotice"
            parameterType="com.kh.triptype.notice.model.vo.Notice">

        UPDATE TB_NOTICE
        SET
            NOTICE_TITLE = #{noticeTitle},
            NOTICE_CONTENT = #{noticeContent},
            NOTICE_UPDATED_AT = SYSDATE,
            NOTICE_IS_IMPORTANT = #{noticeIsImportant}
        WHERE NOTICE_ID = #{noticeId}
          AND NOTICE_IS_DEL = 'N'
    </update>

    <!-- ========================= -->
    <!-- 관리자 : 공지 삭제 -->
    <!-- ========================= -->
    <update id="deleteNotice" parameterType="map">
        UPDATE TB_NOTICE
        SET NOTICE_IS_DEL = 'Y'
        WHERE NOTICE_ID = #{noticeId}
    </update>

    <!-- ========================= -->
    <!-- 조회수 증가 -->
    <!-- ========================= -->
    <update id="increaseViews" parameterType="map">
        UPDATE TB_NOTICE
        SET NOTICE_VIEWS = NOTICE_VIEWS + 1
        WHERE NOTICE_ID = #{noticeId}
          AND NOTICE_IS_DEL = 'N'
    </update>

</mapper>
