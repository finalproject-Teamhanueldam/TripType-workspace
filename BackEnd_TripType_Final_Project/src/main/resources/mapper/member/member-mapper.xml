<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="memberMapper">

    <!-- 이메일 중복 검사 -->
    <select id="countByMemberId" parameterType="string" resultType="int">
        SELECT COUNT(*)
        FROM TB_MEMBER
        WHERE MEMBER_ID = #{memberId}
    </select>

    <!-- 인증번호 유효성 검사 -->
    <select id="isValidAuthCode" resultType="int">
        SELECT COUNT(*)
        FROM TB_AUTH
        WHERE AUTH_EMAIL = #{memberId}
          AND AUTH_CODE = #{authCode}
          AND AUTH_DATE >= SYSDATE - (#{expireMinutes} / 1440)
    </select>

    <!-- 회원 가입 -->
    <insert id="insertMember"
            parameterType="Member">
        INSERT INTO TB_MEMBER (
            MEMBER_NO,
            MEMBER_ID,
            MEMBER_PASSWORD,
            MEMBER_NAME,
            MEMBER_BIRTH_DATE,
            MEMBER_GENDER,
            MEMBER_PHONE,
            MEMBER_CREATE_AT
        ) VALUES (
            TB_MEMBER_SEQ.NEXTVAL,
            #{memberId},
            #{memberPassword},
            #{memberName},
            #{memberBirthDate},
            #{memberGender},
            #{memberPhone},
            SYSDATE
        )
    </insert>

    <!-- 인증 정보 삭제 AUTH_EMAIL이랑 MEMBER_ID는 기능적으로 같다 -->
    <delete id="deleteAuth" parameterType="string">
        DELETE FROM TB_AUTH
        WHERE AUTH_EMAIL = #{memberId}
    </delete>

</mapper>
