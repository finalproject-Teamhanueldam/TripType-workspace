<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kh.triptype.notice.comment.dao.NoticeCommentDao">

    <!-- ========================= -->
    <!-- ResultMap -->
    <!-- ========================= -->
    <resultMap id="noticeCommentResultMap"
               type="com.kh.triptype.notice.comment.model.vo.NoticeComment">

        <id     property="noticeCommentId"         column="NOTICE_COMMENT_ID"/>
        <result property="noticeCommentContent"   column="NOTICE_COMMENT_CONTENT"/>
        <result property="noticeCommentCreatedAt" column="NOTICE_COMMENT_CREATED_AT"/>
        <result property="noticeCommentUpdatedAt" column="NOTICE_COMMENT_UPDATED_AT"/>
        <result property="noticeCommentIsDel"      column="NOTICE_COMMENT_IS_DEL"/>
        <result property="noticeId"                column="NOTICE_ID"/>
        <result property="memberNo"                column="MEMBER_NO"/>
    </resultMap>

    <!-- ========================= -->
    <!-- 사용자 : 댓글 목록 -->
    <!-- ========================= -->
    <select id="selectCommentList"
            parameterType="map"
            resultMap="noticeCommentResultMap">

        SELECT
            NOTICE_COMMENT_ID,
            NOTICE_COMMENT_CONTENT,
            NOTICE_COMMENT_CREATED_AT,
            NOTICE_COMMENT_UPDATED_AT,
            NOTICE_COMMENT_IS_DEL,
            NOTICE_ID,
            MEMBER_NO
        FROM TB_NOTICE_COMMENT
        WHERE NOTICE_ID = #{noticeId}
          AND NOTICE_COMMENT_IS_DEL = 'N'
        ORDER BY NOTICE_COMMENT_CREATED_AT ASC
    </select>

    <!-- ========================= -->
    <!-- 사용자 : 댓글 등록 -->
    <!-- ========================= -->
    <insert id="insertComment"
            parameterType="com.kh.triptype.notice.comment.model.vo.NoticeComment">

        INSERT INTO TB_NOTICE_COMMENT (
            NOTICE_COMMENT_ID,
            NOTICE_COMMENT_CONTENT,
            NOTICE_COMMENT_CREATED_AT,
            NOTICE_COMMENT_UPDATED_AT,
            NOTICE_COMMENT_IS_DEL,
            NOTICE_ID,
            MEMBER_NO
        ) VALUES (
            SEQ_NOTICE_COMMENT_ID.NEXTVAL,
            #{noticeCommentContent},
            SYSDATE,
            SYSDATE,
            'N',
            #{noticeId},
            #{memberNo}
        )
    </insert>

    <!-- ========================= -->
    <!-- 사용자 : 댓글 수정 -->
    <!-- ========================= -->
    <update id="updateComment"
            parameterType="com.kh.triptype.notice.comment.model.vo.NoticeComment">

        UPDATE TB_NOTICE_COMMENT
        SET
            NOTICE_COMMENT_CONTENT = #{noticeCommentContent},
            NOTICE_COMMENT_UPDATED_AT = SYSDATE
        WHERE NOTICE_COMMENT_ID = #{noticeCommentId}
          AND NOTICE_COMMENT_IS_DEL = 'N'
    </update>

    <!-- ========================= -->
    <!-- 사용자/관리자 : 댓글 삭제 -->
    <!-- ========================= -->
    <update id="deleteComment" parameterType="map">
        UPDATE TB_NOTICE_COMMENT
        SET NOTICE_COMMENT_IS_DEL = 'Y'
        WHERE NOTICE_COMMENT_ID = #{noticeCommentId}
    </update>

</mapper>
